<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form id="javascript-upload" action="http://localhost:8089/upload/"
		enctype="multipart/form-data" method="post">
		<label for="jfile">File Upload: <input id="jfile" name="file"
			type="file" />
		</label> <input type="submit" value="Upload File" />
	</form>
	<div style="border: 1px solid black; width: 300px;">
		<div id="status"
			style="background-color: #D3DCE3; width: 0px; height: 12px; margin: 1px;"></div>
	</div>
	<div>
		<span id="received"> </span> <span id="speed"> </span>
	</div>
	<script type="text/javascript">
$('javascript-upload').addEvent('submit', function(e) { // On submit of upload form.
	  var received = 0;
	  var percent  = 0.0;
	  var perform;
	  var periodical;
	  var uuid = Math.floor(Math.random() * 16).toString(16); // Unique uploader ID
	  var check = 2000; // Milliseconds between each XHR request.
	 
	  $('javascript-upload').action += '?X-Progress-ID=' + uuid; // Assign ID to upload.
	 
	  var request = new Request({ // Define the XHR request.
	    url: '/progress?X-Progress-ID=' + uuid, // Using same identifier!
	    method: 'get',
	    link: 'cancel',
	    onComplete: function(response) {
	      var json = JSON.decode(response);
	      if (json.state == 'uploading') {
	        var delta = json.received - received;
	        var bytes = delta / (check / 1000);
	        received  = json.received;
	        percent   = (json.received / json.size) * 100;
	 
	        $('status').tween('width', 298 * percent / 100);
	        $('received').innerHTML = 'Received ' + Math.round(json.received / 1024) + '/' + Math.round(json.size / 1024) + ' KB';
	        $('speed').innerHTML    = 'Speed ' + Math.round(bytes / 1024) + ' KB/s';
	 
	        if (percent >= 100) {
	          $clear(periodical); // Upload done, stop polling Nginx.
	        }
	      }
	    }
	  });
	 
	  perform = function () {
	    request.send();
	  }
	 
	  periodical = perform.periodical(check);
	});
	</script>
</body>
</html>